# Raspberry-Pi--Project
IoT - 라즈베리프로젝트 

# 9일차
## 🌱 미니 프로젝트 개요: "관리자 실시간 환경 모니터링 시스템"

### ✅ 1. 기능 흐름 정리
#### 💻 [A] 웹 UI 및 로그인 기능
- /login (GET): 로그인 화면 보여줌
- /login (POST): ID/PW 검증
    - ✅ 성공 시 → /home 이동
    - ❌ 실패 시 → 팝업(alert) 띄우고 로그인 페이지 다시 로드

#### 📊 [B] 관리자 대시보드 (로그인 후)
##### 🌡️ 실시간 온·습도 표시
- 주기적으로 센서값을 읽어와 화면에 표시됨 (JavaScript fetch)
-💧 습도 & 🔥 온도 수치를 2초마다 갱신

##### 🧰 제어 기능 버튼 (관리자가 직접 조작 가능)
| 버튼                      | 기능 설명                                                                 |
|-------------------------|------------------------------------------------------------------------|
| 🔁 **자동 감지 ON/OFF**     | 온도·습도·조도 중 기준 초과 시 LED 및 부저가 자동 반응하는 기능을 켜거나 끔                   |
| 💡 **LED 수동 제어 ON/OFF** | 전체 LED(빨간/초록)를 수동으로 켜거나 끄는 기능. OFF 시 다른 기능에서도 LED가 꺼진 상태 유지         |
| 🔊 **부저 수동 테스트**      | 관리자 요청 시 부저 1회 울림 (사이렌 효과 짧게)                                         |
| 🧪 **센서값 강제 갱신**      | 현재 센서 상태(온도, 습도, 조도)를 즉시 새로 불러와 화면에 갱신함                                 |


##### 🚨 자동 감지 반응 조건
- 조건
    - 🔥 온도 > 30°C
    - 💧 습도 > 60%
    - ☀️ 조도 > 700

- 반응 동작:
    - 🔴 빨간 LED: 1초 간격으로 계속 깜빡
    - 🔔 부저: 조건 충족 시 단 1회만 울림 (사이렌)
    - 해당 상태는 정상값으로 돌아오기 전까지 유지

##### ✅ 정상 상태 복귀 시 반응
- 조건:
    - 🔥 온도 ≤ 30°C
    - 💧 습도 ≤ 600%
    - ☀️ 조도 ≤ 700
    
- 반응 동작
    - 🔴 빨간 LED 깜빡임 중지
    - 🟢 초록 LED 1초 간격으로 깜빡이며 3초간 정상 알림 표시

#### 💡 LED 제어 방식 설계 포인트
- 🧭 LED 제어 시스템 구조
    - LED 상태 제어는 단순한 ON/OFF가 아닌, 관리자 설정값을 기반으로 모든 동작 흐름을 제어하도록 구성
    - 기본 LED 상태: ON
    - 즉, 시스템이 부팅되거나 실행될 경우 LED가 활성화(ON) 상태로 시작됨
    - 이 상태에서는 자동 감지 모드, 수동 테스트 버튼 등 다른 모든 기능에서 LED가 동작 가능

- 🧰 관리자 수동 OFF 설정 시 동작 원리
    - 관리자가 수동으로 LED를 OFF하면, 단순히 LED를 끄는 것이 아니라 "LED 차단 모드"로 전환

    - 이 설정이 적용되면:

        - 🔴 자동 감지 조건을 만족해도 LED는 켜지지 않음
        - 🟢 수동 제어 버튼을 눌러도 LED는 반응하지 않음
        - ✅ 단, 부저는 별도로 작동 → 관리자에게 경고는 전달됨

- 📌 이 구조를 도입한 이유

    - ❌ 자동 감지 or 수동 제어 시, 예상치 못한 LED 반응 방지
    - ✅ 관리자 의도에 따라 시스템의 시각적 출력(LED)을 확실히 제어 가능
    - ⚠️ 향후 확장 시에도 "제어 차단 상태"를 하나의 플래그 변수로 제어 가능하여 유지보수 용이

#### 🚧 부저(Buzzer) 제어 차단 기능 설계 (⏳ 구현 예정)

- 현재 **부저는 기본 ON 상태**로, 자동 감지 조건 충족 시 1회 울림으로 동작함  
- **LED와 동일한 방식으로 "부저 차단 모드"도 구현 예정**

##### 예정 동작 흐름
- 관리자가 **부저 OFF**로 설정 시:
    - 자동 감지 조건이 충족되어도 **부저는 울리지 않음**
    - 수동 테스트 버튼을 눌러도 **부저 무음 유지**
- **기본값은 ON**, 시스템 부팅 시 자동 활성화됨

##### 구조 설계 계획
- `BUZZER_ENABLED` 전역 변수 도입 예정
    - LED 차단과 같은 방식으로 구현
    - 추후 관리자 UI에 "부저 ON/OFF" 토글 버튼 추가 계획


##### 🧪 예시 시나리오
| 상황 | 자동 감지 조건 충족 | 관리자 LED 차단 설정 | LED 반응 | 부저 반응    |
| -- | ----------- | ------------- | ------ | -------- |
| A  | O           | X             | 🔴 ON  | 🔔 1회 울림 |
| B  | O           | O             | ❌ OFF  | 🔔 1회 울림 |
| C  | X           | X             | ❌ OFF  | ❌ OFF    |


### 📽️ 구현 영상 및 실물 시연
#### 🎬 1. UI 및 기능 흐름 시연 영상 보기()
- 로그인 → 대시보드 진입 → LED 수동 제어 / 자동 감지 / 센서 갱신 등 전체 기능 흐름 시연
- 로그인 인증이 되지 않은 상태에서 /dashboard로 접근 시 차단되는 보안 처리 로직도 확인 가능
    - session['logged_in'] 여부에 따라 JavaScript 알림 + 로그인 페이지로 강제 리디렉션
    - 해당 보안 처리는 기본적인 세션 제어와 클라이언트 UX 흐름 제어 측면에서 중요

```python
@app.route('/dashboard')
def dashboard():
    if not session.get('logged_in'):
        return '''
            <script>
                alert("로그인이 필요합니다!")
                window.location.href = "/login";
            </script>
        '''
```
#### 🎬 2. 센서 반응 실물 영상 보기()
- LED ON/OFF 버튼 클릭 시, 실제 GPIO 핀을 통해 LED가 점등/소등되는 장면 확인 가능
- 온·습도 센서 모듈이 정상 작동하며, 측정값이 대시보드에 2초 간격으로 실시간 갱신됨

##### 🧪 현재 구현 완료 기능
- ✅ LED 수동 제어 (ON/OFF)
- ✅ 온·습도 실시간 표시 (UI 갱신 포함)

##### 🧩 구현 예정 기능
- ⏳ 부저 반응 처리 (조건 만족 시 1회 울림)
- ⏳ 동작 감지 센서 연동
- ⏳ 관리자 수동 요청 시 센서값 강제 갱신 버튼 기능

#### 🧪 실물 시연 흐름 요약
| 동작           | 실물 반응                          | UI 반응                    | 구현 상태   |
| ------------ | ------------------------------ | ------------------------ | ------- |
| LED ON 버튼 클릭 | 빨간/초록 LED 점등                   | `"LED 깜빡임 시작"` 메시지       | ✅ 구현 완료 |
| LED OFF 클릭   | 모든 LED 소등                      | `"LED 깜빡임 중지"` 메시지       | ✅ 구현 완료 |
| 온·습도 자동 감지   | 기준 초과 시 LED 깜빡임 + 부저 울림 *(예정)* | 상태 갱신됨 *(예정)*            | ⏳ 구현 예정 |
| 정상 수치 복귀     | 초록 LED 깜빡이며 정상 상태 알림 *(예정)*    | `"정상 상태로 복귀"` 메시지 *(예정)* | ⏳ 구현 예정 |

